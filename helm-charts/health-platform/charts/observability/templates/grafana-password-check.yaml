{{- if and .Values.grafana.enabled (eq .Values.global.cluster.environment "production") }}
{{- if not .Values.kube-prometheus-stack.grafana.adminPassword }}
{{- fail "ERROR: Grafana adminPassword is required for production deployments. Please set kube-prometheus-stack.grafana.adminPassword in values-production.yaml" }}
{{- end }}
{{- if eq .Values.kube-prometheus-stack.grafana.adminPassword "" }}
{{- fail "ERROR: Grafana adminPassword cannot be empty for production deployments. Please set a strong password in values-production.yaml" }}
{{- end }}
{{- if lt (len .Values.kube-prometheus-stack.grafana.adminPassword) 12 }}
{{- fail "ERROR: Grafana adminPassword must be at least 12 characters long for production deployments" }}
{{- end }}
{{- end }}
---
# This file validates production security requirements
# If deployment reaches this point, password requirements are met
apiVersion: v1
kind: ConfigMap
metadata:
  name: observability-security-validation
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "observability.labels" . | nindent 4 }}
  annotations:
    description: "Security validation passed for observability stack"
data:
  validation-status: "passed"
  environment: {{ .Values.global.cluster.environment | quote }}
  validated-at: {{ now | date "2006-01-02T15:04:05Z07:00" | quote }}
