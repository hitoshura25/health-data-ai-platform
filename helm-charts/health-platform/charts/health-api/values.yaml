namespace: health-api

replicaCount: 2

image:
  repository: ghcr.io/your-org/health-api
  tag: "latest"
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 8001
  # Health API runs on port 8000 internally
  targetPort: 8000

ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/rate-limit: "100"
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"  # Large file uploads
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
  host: api.yourdomain.com
  tls:
    enabled: true
    secretName: health-api-tls

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

resources:
  requests:
    cpu: 250m
    memory: 256Mi
  limits:
    cpu: 1000m
    memory: 512Mi

# Database configuration
database:
  host: postgresql-health.health-data.svc.cluster.local
  port: 5432
  name: healthdb
  user: healthapi
  # Password from secret

# Redis configuration
redis:
  host: redis-health.health-data.svc.cluster.local
  port: 6379
  # Password from secret

# MinIO configuration
minio:
  endpoint: minio.health-data.svc.cluster.local:9000
  bucket: health-data
  # Credentials from secret

# RabbitMQ configuration
rabbitmq:
  host: rabbitmq.health-data.svc.cluster.local
  port: 5672
  exchange: health-data-upload
  routingKey: raw-data
  # Credentials from secret

# WebAuthn JWT verification
webauthn:
  jwksUrl: http://webauthn-server.health-auth.svc.cluster.local:8080/.well-known/jwks.json
  issuer: mpo-webauthn
  jwksCacheLifespan: 300

# Jaeger tracing
jaeger:
  enabled: true
  # Standard OTLP gRPC port (4317), not Docker Compose host-mapped port (4319)
  otlpEndpoint: http://jaeger-collector.health-observability.svc.cluster.local:4317
  serviceName: health-api-service

# Application settings
app:
  logLevel: INFO
  workers: 4
  maxUploadSizeMB: 50
  uploadRateLimit: "10/minute"
  allowedOrigins: "https://app.yourdomain.com"
  ssoUserEmailDomain: "sso.example.com"

# Secrets (use Sealed Secrets in production)
# These are placeholder values for development
secrets:
  secretKey: "CHANGE_ME_SECRET_KEY_MIN_32_CHARS"
  database:
    password: "CHANGE_ME"
  redis:
    password: "CHANGE_ME"
  minio:
    accessKey: "CHANGE_ME"
    secretKey: "CHANGE_ME"
  rabbitmq:
    password: "CHANGE_ME"

# Service Account
serviceAccount:
  create: true
  name: health-api-sa
  annotations: {}

# Pod annotations
podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/port: "8001"
  prometheus.io/path: "/metrics"

# Security context
securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}
