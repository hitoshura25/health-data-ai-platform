# Health Data AI Platform - Main Orchestrator
#
# This file orchestrates all microservices and infrastructure for the platform.
#
# Services included:
# - Infrastructure: PostgreSQL, Redis (shared data stores)
# - Data Storage: MinIO S3-compatible object storage
# - Message Queue: RabbitMQ for async processing
# - API Services: Health API (upload & query)
#
# Authentication & Observability:
#   WebAuthn authentication and Jaeger tracing are provided by the
#   webauthn-stack (see webauthn-stack/docker/docker-compose.yml).
#   Start that stack first for authentication and distributed tracing.
#
# Usage:
#   # Start WebAuthn stack (authentication + Jaeger)
#   cd webauthn-stack/docker && docker compose up -d && cd ../..
#
#   # Start health services
#   docker compose up -d                    # Start all services
#   docker compose up -d health-api         # Start health-api and dependencies only
#   docker compose logs -f health-api       # View health-api logs
#   docker compose down                     # Stop all services
#   docker compose down -v                  # Stop and remove volumes
#
# Environment:
#   Copy .env.example to .env and configure before running

# Include shared infrastructure components
include:
  # Shared infrastructure (used by multiple services)
  - path: infrastructure/postgres.compose.yml
  - path: infrastructure/redis.compose.yml

  # Data storage (MinIO S3-compatible object storage)
  - path: services/data-lake/deployment/minio.compose.yml

  # Message queue (RabbitMQ for async processing)
  - path: services/message-queue/deployment/rabbitmq.compose.yml

  # API services
  - path: services/health-api-service/health-api.compose.yml

  # ETL services
  - path: services/etl-narrative-engine/deployment/etl-narrative-engine.compose.yml

# Create the shared network that all services will use
networks:
  health-platform-net:
    driver: bridge
    name: health-platform-net
